-- Generated KuzuDB SQL Schema
-- 
-- Schema: Relish Authorization Schema
-- Version: 1.0
-- Description: Multi-tenant authorization graph with ReBAC
-- 
-- This file is auto-generated by @relish/schema-compiler
-- DO NOT EDIT MANUALLY

-- Entity Tables

-- Application user or service account
CREATE NODE TABLE User(
  id STRING NOT NULL,
  email STRING,
  name STRING,
  active BOOLEAN,
  created_at TIMESTAMP,
  PRIMARY KEY(id)
);

-- User group or team
CREATE NODE TABLE Group(
  id STRING NOT NULL,
  name STRING NOT NULL,
  description STRING,
  created_at TIMESTAMP,
  PRIMARY KEY(id)
);

-- Protected resource (document, folder, API, etc.)
CREATE NODE TABLE Resource(
  id STRING NOT NULL,
  type STRING NOT NULL,
  name STRING NOT NULL,
  owner_id STRING NOT NULL,
  created_at TIMESTAMP,
  PRIMARY KEY(id)
);

-- Role definition with permissions
CREATE NODE TABLE Role(
  id STRING NOT NULL,
  name STRING NOT NULL,
  description STRING,
  permissions STRING,
  PRIMARY KEY(id)
);

-- Relationship Tables

-- User is a member of a group
CREATE REL TABLE member_of(FROM User TO Group, joined_at TIMESTAMP);

-- Group inherits permissions from another group
CREATE REL TABLE inherits_from(FROM Group TO Group);

-- Direct user permission on a resource
CREATE REL TABLE has_permission(FROM User TO Resource, permission STRING NOT NULL, granted_at TIMESTAMP, granted_by STRING);

-- Group permission on a resource
CREATE REL TABLE group_permission(FROM Group TO Resource, permission STRING NOT NULL, granted_at TIMESTAMP);

-- User has a role
CREATE REL TABLE has_role(FROM User TO Role, scope STRING, assigned_at TIMESTAMP);

-- User owns a resource
CREATE REL TABLE owns(FROM User TO Resource);

-- Indexes

-- CREATE INDEX idx_User_email_unique ON User(email);
-- CREATE INDEX idx_User_email ON User(email);

-- Note: KuzuDB indexes are created automatically on primary keys
-- Additional indexes commented out - verify KuzuDB support before uncommenting