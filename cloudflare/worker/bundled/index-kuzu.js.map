{
  "version": 3,
  "sources": ["../src/durable-objects/graph-state.ts", "../src/durable-objects/graph-state-csv.ts", "../src/index-kuzu.ts"],
  "sourceRoot": "bundled/",
  "sourcesContent": ["/**\n * Durable Object for managing authorization graph state\n *\n * Maintains an in-memory KuzuDB WASM instance with the permission graph.\n * Handles all read and write operations with strong consistency.\n * Periodically backs up to R2 for durability.\n *\n * Note: KuzuDB WASM integration will be added in next phase.\n * For now, using in-memory graph structure for testing.\n */\n\ninterface Env {\n  GRAPH_STATE: R2Bucket;\n  MAX_GRAPH_SIZE: string;\n  BACKUP_INTERVAL: string;\n}\n\ninterface PermissionTuple {\n  user: string;\n  permission: string;\n  resource: string;\n}\n\nexport class GraphState {\n  private state: DurableObjectState;\n  private env: Env;\n  // TODO: Add KuzuDB WASM integration\n  // For now, using simple in-memory set for testing\n  private permissions: Set<string> = new Set();\n  private initialized: boolean = false;\n  private lastBackup: number = 0;\n  private recordCount: number = 0;\n\n  constructor(state: DurableObjectState, env: Env) {\n    this.state = state;\n    this.env = env;\n\n    // Block concurrent executions during initialization\n    this.state.blockConcurrencyWhile(async () => {\n      await this.initialize();\n    });\n  }\n\n  /**\n   * Initialize graph state\n   */\n  private async initialize() {\n    if (this.initialized) return;\n\n    console.log(\"[GraphState] Initializing...\");\n\n    try {\n      // Try to restore from R2 if backup exists\n      await this.restoreFromBackup();\n\n      this.initialized = true;\n      console.log(\"[GraphState] Initialization complete\");\n    } catch (error) {\n      console.error(\"[GraphState] Initialization failed:\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Create the authorization graph schema\n   * TODO: Replace with KuzuDB schema when WASM is integrated\n   */\n  private async createSchema() {\n    // Placeholder for KuzuDB schema creation\n    console.log(\"[GraphState] Schema created (in-memory)\");\n  }\n\n  /**\n   * Handle incoming requests\n   */\n  async fetch(request: Request): Promise<Response> {\n    if (!this.initialized) {\n      return this.jsonResponse({ error: \"Not initialized\" }, 503);\n    }\n\n    try {\n      const body = await request.json<any>();\n      const { action } = body;\n\n      switch (action) {\n        case \"check\":\n          return await this.handleCheck(body);\n        case \"grant\":\n          return await this.handleGrant(body);\n        case \"revoke\":\n          return await this.handleRevoke(body);\n        case \"list\":\n          return await this.handleList(body);\n        case \"bulk\":\n          return await this.handleBulk(body);\n        case \"stats\":\n          return await this.handleStats();\n        default:\n          return this.jsonResponse({ error: \"Unknown action\" }, 400);\n      }\n    } catch (error) {\n      console.error(\"[GraphState] Request error:\", error);\n      return this.jsonResponse(\n        {\n          error: \"Request failed\",\n          message: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        500\n      );\n    }\n  }\n\n  /**\n   * Check if user has permission on resource\n   * Simple in-memory check for now\n   */\n  private async handleCheck(body: {\n    user: string;\n    permission: string;\n    resource: string;\n  }): Promise<Response> {\n    const { user, permission, resource } = body;\n\n    try {\n      const key = `${user}:${permission}:${resource}`;\n      const allowed = this.permissions.has(key);\n\n      return this.jsonResponse({ allowed });\n    } catch (error) {\n      console.error(\"[GraphState] Check error:\", error);\n      return this.jsonResponse({\n        allowed: false,\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      });\n    }\n  }\n\n  /**\n   * Grant permission\n   */\n  private async handleGrant(body: {\n    user: string;\n    permission: string;\n    resource: string;\n  }): Promise<Response> {\n    const { user, permission, resource } = body;\n\n    try {\n      const key = `${user}:${permission}:${resource}`;\n      this.permissions.add(key);\n      this.recordCount++;\n\n      await this.maybeBackup();\n\n      return this.jsonResponse({ success: true, user, permission, resource });\n    } catch (error) {\n      console.error(\"[GraphState] Grant error:\", error);\n      return this.jsonResponse(\n        {\n          success: false,\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        500\n      );\n    }\n  }\n\n  /**\n   * Revoke permission\n   */\n  private async handleRevoke(body: {\n    user: string;\n    permission: string;\n    resource: string;\n  }): Promise<Response> {\n    const { user, permission, resource } = body;\n\n    try {\n      const key = `${user}:${permission}:${resource}`;\n      if (this.permissions.delete(key)) {\n        this.recordCount--;\n      }\n\n      await this.maybeBackup();\n\n      return this.jsonResponse({ success: true, user, permission, resource });\n    } catch (error) {\n      console.error(\"[GraphState] Revoke error:\", error);\n      return this.jsonResponse(\n        {\n          success: false,\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        500\n      );\n    }\n  }\n\n  /**\n   * List permissions for user or resource\n   */\n  private async handleList(body: {\n    user?: string;\n    resource?: string;\n  }): Promise<Response> {\n    const { user, resource } = body;\n\n    try {\n      const permissions: any[] = [];\n\n      for (const key of this.permissions.keys()) {\n        const [u, perm, res] = key.split(\":\");\n\n        if (user && u === user) {\n          permissions.push({ resource: res, permission: perm });\n        } else if (resource && res === resource) {\n          permissions.push({ user: u, permission: perm });\n        }\n      }\n\n      return this.jsonResponse({ permissions });\n    } catch (error) {\n      console.error(\"[GraphState] List error:\", error);\n      return this.jsonResponse(\n        { error: error instanceof Error ? error.message : \"Unknown error\" },\n        500\n      );\n    }\n  }\n\n  /**\n   * Handle bulk operations\n   */\n  private async handleBulk(body: {\n    operations: Array<any>;\n  }): Promise<Response> {\n    const { operations } = body;\n    const results: any[] = [];\n\n    for (const op of operations) {\n      try {\n        let result;\n        switch (op.action) {\n          case \"grant\":\n            result = await this.handleGrant(op);\n            break;\n          case \"revoke\":\n            result = await this.handleRevoke(op);\n            break;\n          case \"check\":\n            result = await this.handleCheck(op);\n            break;\n          default:\n            result = this.jsonResponse({ error: \"Unknown action\" }, 400);\n        }\n        results.push(await result.json());\n      } catch (error) {\n        results.push({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        });\n      }\n    }\n\n    return this.jsonResponse({ results });\n  }\n\n  /**\n   * Get stats about the graph\n   */\n  private async handleStats(): Promise<Response> {\n    try {\n      const users = new Set<string>();\n      const resources = new Set<string>();\n\n      for (const key of this.permissions.keys()) {\n        const [user, , resource] = key.split(\":\");\n        users.add(user);\n        resources.add(resource);\n      }\n\n      return this.jsonResponse({\n        users: users.size,\n        resources: resources.size,\n        permissions: this.permissions.size,\n        recordCount: this.recordCount,\n        lastBackup: this.lastBackup,\n      });\n    } catch (error) {\n      console.error(\"[GraphState] Stats error:\", error);\n      return this.jsonResponse(\n        { error: error instanceof Error ? error.message : \"Unknown error\" },\n        500\n      );\n    }\n  }\n\n  /**\n   * Backup to R2 if needed\n   */\n  private async maybeBackup() {\n    const interval = parseInt(this.env.BACKUP_INTERVAL || \"3600\", 10) * 1000;\n    const now = Date.now();\n\n    if (now - this.lastBackup > interval) {\n      await this.backupToR2();\n      this.lastBackup = now;\n    }\n  }\n\n  /**\n   * Backup graph state to R2\n   */\n  private async backupToR2() {\n    try {\n      const permissionsArray = Array.from(this.permissions.keys());\n\n      const backup = {\n        timestamp: new Date().toISOString(),\n        permissions: permissionsArray,\n        recordCount: this.recordCount,\n      };\n\n      await this.env.GRAPH_STATE.put(\n        \"latest-backup.json\",\n        JSON.stringify(backup)\n      );\n      console.log(\"[GraphState] Backed up to R2\");\n    } catch (error) {\n      console.error(\"[GraphState] Backup failed:\", error);\n    }\n  }\n\n  /**\n   * Restore from R2 backup\n   */\n  private async restoreFromBackup() {\n    try {\n      const backup = await this.env.GRAPH_STATE.get(\"latest-backup.json\");\n      if (!backup) {\n        console.log(\"[GraphState] No backup found\");\n        return;\n      }\n\n      const data = await backup.json<any>();\n      console.log(\"[GraphState] Restoring from backup:\", data.timestamp);\n\n      // Restore permissions\n      if (data.permissions && Array.isArray(data.permissions)) {\n        this.permissions = new Set(data.permissions);\n      }\n\n      this.recordCount = data.recordCount || 0;\n      this.lastBackup = Date.now();\n    } catch (error) {\n      console.error(\"[GraphState] Restore failed:\", error);\n    }\n  }\n\n  /**\n   * Export table data\n   * Placeholder for future KuzuDB integration\n   */\n  private async exportTable(tableName: string): Promise<any[]> {\n    return [];\n  }\n\n  /**\n   * Helper to create JSON response\n   */\n  private jsonResponse(data: any, status: number = 200): Response {\n    return new Response(JSON.stringify(data), {\n      status,\n      headers: { \"Content-Type\": \"application/json\" },\n    });\n  }\n}\n", "/**\n * Durable Object for Graph State with Real CSV Data\n *\n * Uses Map-based indexes (same as test-graph-data.ts) to validate\n * the full authorization logic with transitive permissions.\n * Loads data from R2 CSV files.\n */\n\ninterface Env {\n  GRAPH_STATE: R2Bucket;\n}\n\ninterface Permission {\n  can_create: boolean;\n  can_read: boolean;\n  can_update: boolean;\n  can_delete: boolean;\n  granted_at: string;\n  granted_by: string;\n}\n\nexport class GraphStateCSV {\n  private state: DurableObjectState;\n  private env: Env;\n  private orgId: string;\n  private initialized: boolean = false;\n\n  // Indexes (same as test-graph-data.ts)\n  private memberOfIndex = new Map<string, Set<string>>();\n  private inheritsFromIndex = new Map<string, string>();\n  private userPermIndex = new Map<string, Map<string, Permission>>();\n  private groupPermIndex = new Map<string, Map<string, Permission>>();\n\n  constructor(state: DurableObjectState, env: Env) {\n    this.state = state;\n    this.env = env;\n    this.orgId = state.id.name || \"org_default\";\n    console.log(`[GraphStateCSV] Constructed for ${this.orgId}`);\n  }\n\n  /**\n   * Handle incoming requests\n   */\n  async fetch(request: Request): Promise<Response> {\n    try {\n      await this.ensureInitialized();\n\n      const url = new URL(request.url);\n      const path = url.pathname;\n\n      if (path === \"/check\" || path.endsWith(\"/check\")) {\n        return await this.handleCheck(request);\n      } else if (path === \"/stats\" || path.endsWith(\"/stats\")) {\n        return await this.handleStats();\n      } else if (path === \"/grant\" || path.endsWith(\"/grant\")) {\n        return await this.handleGrant(request);\n      }\n\n      return this.jsonResponse({ error: \"Unknown path\" }, 400);\n    } catch (error) {\n      console.error(`[GraphStateCSV ${this.orgId}] Request error:`, error);\n      return this.jsonResponse(\n        {\n          error: \"Request failed\",\n          message: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        500\n      );\n    }\n  }\n\n  /**\n   * Lazy initialization\n   */\n  private async ensureInitialized() {\n    if (this.initialized) return;\n\n    console.log(`[GraphStateCSV ${this.orgId}] Initializing...`);\n    const startTime = Date.now();\n\n    try {\n      await this.loadDataFromR2();\n      this.initialized = true;\n      const duration = Date.now() - startTime;\n      console.log(\n        `[GraphStateCSV ${this.orgId}] Initialization complete in ${duration}ms`\n      );\n    } catch (error) {\n      console.error(\n        `[GraphStateCSV ${this.orgId}] Initialization failed:`,\n        error\n      );\n      throw error;\n    }\n  }\n\n  /**\n   * Load CSV data from R2 and build indexes\n   */\n  private async loadDataFromR2() {\n    // Load member_of relationships\n    const memberOfObj = await this.env.GRAPH_STATE.get(\n      `${this.orgId}/member_of.csv`\n    );\n    if (memberOfObj) {\n      const csv = await memberOfObj.text();\n      const lines = csv.trim().split(\"\\n\").slice(1); // Skip header\n\n      for (const line of lines) {\n        const [userId, groupId] = this.parseCSVLine(line);\n        if (!this.memberOfIndex.has(userId)) {\n          this.memberOfIndex.set(userId, new Set());\n        }\n        this.memberOfIndex.get(userId)!.add(groupId);\n      }\n      console.log(\n        `[GraphStateCSV ${this.orgId}] Loaded ${lines.length} member_of relationships`\n      );\n    }\n\n    // Load inherits_from relationships\n    const inheritsObj = await this.env.GRAPH_STATE.get(\n      `${this.orgId}/inherits_from.csv`\n    );\n    if (inheritsObj) {\n      const csv = await inheritsObj.text();\n      const lines = csv.trim().split(\"\\n\").slice(1);\n\n      for (const line of lines) {\n        const [fromGroup, toGroup] = this.parseCSVLine(line);\n        this.inheritsFromIndex.set(fromGroup, toGroup);\n      }\n      console.log(\n        `[GraphStateCSV ${this.orgId}] Loaded ${lines.length} inherits_from relationships`\n      );\n    }\n\n    // Load user permissions\n    const userPermObj = await this.env.GRAPH_STATE.get(\n      `${this.orgId}/user_permissions.csv`\n    );\n    if (userPermObj) {\n      const csv = await userPermObj.text();\n      const lines = csv.trim().split(\"\\n\").slice(1);\n\n      for (const line of lines) {\n        const [\n          userId,\n          resourceId,\n          canCreate,\n          canRead,\n          canUpdate,\n          canDelete,\n          grantedAt,\n          grantedBy,\n        ] = this.parseCSVLine(line);\n\n        if (!this.userPermIndex.has(userId)) {\n          this.userPermIndex.set(userId, new Map());\n        }\n\n        this.userPermIndex.get(userId)!.set(resourceId, {\n          can_create: canCreate === \"True\" || canCreate === \"true\",\n          can_read: canRead === \"True\" || canRead === \"true\",\n          can_update: canUpdate === \"True\" || canUpdate === \"true\",\n          can_delete: canDelete === \"True\" || canDelete === \"true\",\n          granted_at: grantedAt || \"\",\n          granted_by: grantedBy || \"\",\n        });\n      }\n      console.log(\n        `[GraphStateCSV ${this.orgId}] Loaded ${lines.length} user permissions`\n      );\n    }\n\n    // Load group permissions\n    const groupPermObj = await this.env.GRAPH_STATE.get(\n      `${this.orgId}/group_permissions.csv`\n    );\n    if (groupPermObj) {\n      const csv = await groupPermObj.text();\n      const lines = csv.trim().split(\"\\n\").slice(1);\n\n      for (const line of lines) {\n        const [\n          groupId,\n          resourceId,\n          canCreate,\n          canRead,\n          canUpdate,\n          canDelete,\n          grantedAt,\n          grantedBy,\n        ] = this.parseCSVLine(line);\n\n        if (!this.groupPermIndex.has(groupId)) {\n          this.groupPermIndex.set(groupId, new Map());\n        }\n\n        this.groupPermIndex.get(groupId)!.set(resourceId, {\n          can_create: canCreate === \"True\" || canCreate === \"true\",\n          can_read: canRead === \"True\" || canRead === \"true\",\n          can_update: canUpdate === \"True\" || canUpdate === \"true\",\n          can_delete: canDelete === \"True\" || canDelete === \"true\",\n          granted_at: grantedAt || \"\",\n          granted_by: grantedBy || \"\",\n        });\n      }\n      console.log(\n        `[GraphStateCSV ${this.orgId}] Loaded ${lines.length} group permissions`\n      );\n    }\n  }\n\n  /**\n   * Parse CSV line handling quoted fields\n   */\n  private parseCSVLine(line: string): string[] {\n    const result: string[] = [];\n    let current = \"\";\n    let inQuotes = false;\n\n    for (let i = 0; i < line.length; i++) {\n      const char = line[i];\n\n      if (char === '\"') {\n        inQuotes = !inQuotes;\n      } else if (char === \",\" && !inQuotes) {\n        result.push(current.trim());\n        current = \"\";\n      } else {\n        current += char;\n      }\n    }\n\n    result.push(current.trim());\n    return result;\n  }\n\n  /**\n   * Check permission with transitive group resolution\n   * (Same logic as test-graph-data.ts)\n   */\n  private async handleCheck(request: Request): Promise<Response> {\n    try {\n      const body = await request.json<any>();\n      const { user, resource, action } = body;\n\n      if (!user || !resource || !action) {\n        return this.jsonResponse({ error: \"Missing parameters\" }, 400);\n      }\n\n      const allowed = this.checkPermission(user, resource, action);\n      return this.jsonResponse({ allowed });\n    } catch (error) {\n      console.error(`[GraphStateCSV ${this.orgId}] Check error:`, error);\n      return this.jsonResponse({\n        allowed: false,\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      });\n    }\n  }\n\n  /**\n   * Check permission logic (same as test-graph-data.ts)\n   */\n  private checkPermission(\n    userId: string,\n    resource: string,\n    action: \"create\" | \"read\" | \"update\" | \"delete\"\n  ): boolean {\n    const permKey = `can_${action}` as keyof Permission;\n\n    // 1. Check direct user permission\n    const userPerms = this.userPermIndex.get(userId)?.get(resource);\n    if (userPerms && userPerms[permKey]) {\n      return true;\n    }\n\n    // 2. Check group permissions (including inherited)\n    const userGroups = this.memberOfIndex.get(userId);\n    if (!userGroups) {\n      return false;\n    }\n\n    // Get all groups including inherited ones\n    const allGroups = new Set<string>();\n    const queue = Array.from(userGroups);\n\n    while (queue.length > 0) {\n      const groupId = queue.shift()!;\n      if (allGroups.has(groupId)) continue;\n\n      allGroups.add(groupId);\n\n      // Check if this group inherits from another\n      const parentGroup = this.inheritsFromIndex.get(groupId);\n      if (parentGroup) {\n        queue.push(parentGroup);\n      }\n    }\n\n    // Check permissions for all groups\n    for (const groupId of allGroups) {\n      const groupPerms = this.groupPermIndex.get(groupId)?.get(resource);\n      if (groupPerms && groupPerms[permKey]) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Grant permission (simplified - just adds to index)\n   */\n  private async handleGrant(request: Request): Promise<Response> {\n    try {\n      const body = await request.json<any>();\n      const { user, permission, resource } = body;\n\n      if (!user || !permission || !resource) {\n        return this.jsonResponse({ error: \"Missing parameters\" }, 400);\n      }\n\n      if (!this.userPermIndex.has(user)) {\n        this.userPermIndex.set(user, new Map());\n      }\n\n      const perm: Permission = {\n        can_create: permission === \"create\",\n        can_read: permission === \"read\",\n        can_update: permission === \"update\",\n        can_delete: permission === \"delete\",\n        granted_at: new Date().toISOString(),\n        granted_by: \"system\",\n      };\n\n      this.userPermIndex.get(user)!.set(resource, perm);\n\n      return this.jsonResponse({ success: true, user, permission, resource });\n    } catch (error) {\n      console.error(`[GraphStateCSV ${this.orgId}] Grant error:`, error);\n      return this.jsonResponse(\n        {\n          success: false,\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        500\n      );\n    }\n  }\n\n  /**\n   * Get stats\n   */\n  private async handleStats(): Promise<Response> {\n    try {\n      return this.jsonResponse({\n        orgId: this.orgId,\n        users: this.userPermIndex.size,\n        groups: this.groupPermIndex.size,\n        memberOfRelationships: Array.from(this.memberOfIndex.values()).reduce(\n          (sum, set) => sum + set.size,\n          0\n        ),\n        inheritsFromRelationships: this.inheritsFromIndex.size,\n        userPermissions: Array.from(this.userPermIndex.values()).reduce(\n          (sum, map) => sum + map.size,\n          0\n        ),\n        groupPermissions: Array.from(this.groupPermIndex.values()).reduce(\n          (sum, map) => sum + map.size,\n          0\n        ),\n      });\n    } catch (error) {\n      console.error(`[GraphStateCSV ${this.orgId}] Stats error:`, error);\n      return this.jsonResponse(\n        { error: error instanceof Error ? error.message : \"Unknown error\" },\n        500\n      );\n    }\n  }\n\n  /**\n   * Helper to create JSON response\n   */\n  private jsonResponse(data: any, status: number = 200): Response {\n    return new Response(JSON.stringify(data), {\n      status,\n      headers: { \"Content-Type\": \"application/json\" },\n    });\n  }\n}\n", "/**\n * Cloudflare Worker for Multi-Tenant Authorization with KuzuDB WASM\n *\n * Routes requests to per-organization Durable Objects\n * Each org gets its own KuzuDB instance with isolated data\n */\n\nexport interface Env {\n  GRAPH_STATE_DO: DurableObjectNamespace;\n  GRAPH_STATE: R2Bucket;\n  ENVIRONMENT: string;\n}\n\n// Export all DO implementations\nexport { GraphState } from \"./durable-objects/graph-state\";\n// export { GraphStateKuzu } from \"./durable-objects/graph-state-kuzu\"; // Commented out: 15MB bundle exceeds limits\nexport { GraphStateCSV } from \"./durable-objects/graph-state-csv\";\n\n/**\n * Extract organization ID from request\n * Supports: /org/acme/check or header X-Org-Id\n */\nfunction extractOrgId(request: Request): string {\n  const url = new URL(request.url);\n\n  // Try path: /org/{orgId}/...\n  const pathMatch = url.pathname.match(/^\\/org\\/([^\\/]+)/);\n  if (pathMatch) {\n    return `org_${pathMatch[1]}`;\n  }\n\n  // Try header\n  const headerOrg = request.headers.get(\"X-Org-Id\");\n  if (headerOrg) {\n    return `org_${headerOrg}`;\n  }\n\n  // Default org for testing\n  return \"org_default\";\n}\n\n/**\n * Main Worker entry point\n */\nexport default {\n  async fetch(\n    request: Request,\n    env: Env,\n    ctx: ExecutionContext\n  ): Promise<Response> {\n    const url = new URL(request.url);\n    const path = url.pathname;\n\n    // CORS headers\n    const corsHeaders = {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type, Authorization, X-Org-Id\",\n    };\n\n    // Handle preflight\n    if (request.method === \"OPTIONS\") {\n      return new Response(null, { headers: corsHeaders });\n    }\n\n    try {\n      // Health check\n      if (path === \"/health\") {\n        return jsonResponse(\n          { status: \"healthy\", environment: env.ENVIRONMENT },\n          { headers: corsHeaders }\n        );\n      }\n\n      // Extract organization ID\n      const orgId = extractOrgId(request);\n\n      // Get org-specific Durable Object\n      const id = env.GRAPH_STATE_DO.idFromName(orgId);\n      const stub = env.GRAPH_STATE_DO.get(id);\n\n      // Strip /org/{orgId} prefix from path for forwarding\n      let forwardPath = path.replace(/^\\/org\\/[^\\/]+/, \"\");\n      if (!forwardPath) forwardPath = \"/\";\n\n      // Create new URL with stripped path\n      const forwardUrl = new URL(forwardPath, url.origin);\n      forwardUrl.search = url.search;\n\n      // Forward to Durable Object\n      const doRequest = new Request(forwardUrl.toString(), {\n        method: request.method,\n        headers: request.headers,\n        body: request.body,\n      });\n\n      const response = await stub.fetch(doRequest);\n\n      // Add CORS headers to response\n      const newResponse = new Response(response.body, {\n        status: response.status,\n        statusText: response.statusText,\n        headers: response.headers,\n      });\n\n      Object.entries(corsHeaders).forEach(([key, value]) => {\n        newResponse.headers.set(key, value);\n      });\n\n      return newResponse;\n    } catch (error) {\n      console.error(\"Worker error:\", error);\n      return jsonResponse(\n        {\n          error: \"Internal server error\",\n          message: error instanceof Error ? error.message : \"Unknown error\",\n        },\n        { status: 500, headers: corsHeaders }\n      );\n    }\n  },\n};\n\n/**\n * Helper to create JSON response\n */\nfunction jsonResponse(data: any, init?: ResponseInit): Response {\n  const headers = new Headers(init?.headers);\n  headers.set(\"Content-Type\", \"application/json\");\n\n  return new Response(JSON.stringify(data), {\n    ...init,\n    headers,\n  });\n}\n"],
  "mappings": "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",
  "names": []
}
